<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заявка на трансфер</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; }
        input { width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background-color: #3390ec; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; margin-top: 20px;}
    </style>
</head>
<body>

    <h3>Создание заявки</h3>

    <label>Пассажиры:</label>
    <input type="text" id="guests" placeholder="Иванов, Петров (через запятую)">

    <label>Отель:</label>
    <input type="text" id="hotel" placeholder="Название отеля">

    <label>Рейс:</label>
    <input type="text" id="flight" placeholder="Номер рейса">

    <button id="btn" onclick="sendData()">ОТПРАВИТЬ (ТЕСТ)</button>

    <div id="status" style="margin-top: 20px; color: red;"></div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        function sendData() {
            // ШАГ 1: Проверяем, нажалась ли кнопка
            alert("Кнопка нажата! Начинаем сбор данных...");

            let guests = document.getElementById("guests").value;
            let hotel = document.getElementById("hotel").value;
            let flight = document.getElementById("flight").value;

            // ШАГ 2: Проверяем данные
            if (!hotel) {
                alert("Ошибка: Не введен отель!");
                return;
            }

            let data = {
                guests: guests.split(','), // Превращаем строку в список
                hotel: hotel,
                flight: flight
            };

            // ШАГ 3: Показываем, что отправляем
            alert("Отправляю данные: " + JSON.stringify(data));

            try {
                tg.sendData(JSON.stringify(data));
                // ШАГ 4: Команда на закрытие
                alert("Команда sendData ушла. Закрываю окно.");
                tg.close();
            } catch (e) {
                alert("ОШИБКА: " + e.message);
                document.getElementById("status").innerText = e.message;
            }
        }
    </script>
</body>
</html>